# ë„ë©”ì¸ë³„ íŠ¸ëŸ¬ë¸”ìŠˆíŒ… ì²´í¬ë¦¬ìŠ¤íŠ¸

## ğŸ“‹ ê°œìš”

ê° ë„ë©”ì¸ì—ì„œ ë°œìƒí•  ìˆ˜ ìˆëŠ” ì£¼ìš” íŠ¸ëŸ¬ë¸”ìŠˆíŒ… í¬ì¸íŠ¸ì™€ ê°œì„  ë°©ì•ˆì„ ì •ë¦¬í•©ë‹ˆë‹¤. **ì¸ë±ìŠ¤, íŠ¸ëœì­ì…˜, ë½, ìë£Œêµ¬ì¡°/ì•Œê³ ë¦¬ì¦˜** ì ìš©ì´ í•„ìš”í•œ ë¶€ë¶„ì„ ë„ë©”ì¸ë³„ë¡œ ì •ë¦¬í–ˆìŠµë‹ˆë‹¤.

---

## 1. ğŸ¯ Meetup (ëª¨ì„) ë„ë©”ì¸ (í–ˆìŒ)

### âš ï¸ ê°€ì¥ ì‹¬ê°í•œ ë¬¸ì œ: Race Condition (ë™ì‹œì„± ë¬¸ì œ)

**ìœ„ì¹˜**: `MeetupService.joinMeetup()`, `MeetupService.cancelMeetupParticipation()`

**ë¬¸ì œ ìƒí™©**:
```java
// MeetupService.java:277-279
if (meetup.getCurrentParticipants() >= meetup.getMaxParticipants()) {
    throw new RuntimeException("ëª¨ì„ ì¸ì›ì´ ê°€ë“ ì°¼ìŠµë‹ˆë‹¤.");
}
// ... 
meetup.setCurrentParticipants(meetup.getCurrentParticipants() + 1); // âš ï¸ Race Condition!
```

**ì‹œë‚˜ë¦¬ì˜¤**:
- ë™ì‹œì— 2ëª…ì´ ëª¨ì„ì— ì°¸ê°€ ì‹œë„
- ë‘˜ ë‹¤ `currentParticipants < maxParticipants` ì²´í¬ í†µê³¼
- ë‘˜ ë‹¤ ì°¸ê°€ ì„±ê³µ â†’ ì¸ì› ì´ˆê³¼ ë°œìƒ!

**í•´ê²° ë°©ì•ˆ**:

#### 1.1 Pessimistic Lock ì ìš© (ì¦‰ì‹œ ì ìš© ê°€ëŠ¥)
```java
@Transactional
public MeetupParticipantsDTO joinMeetup(Long meetupIdx, String userId) {
    // Pessimistic Lockìœ¼ë¡œ ë™ì‹œ ì ‘ê·¼ ë°©ì§€
    Meetup meetup = meetupRepository.findById(meetupIdx)
        .orElseThrow(() -> new RuntimeException("ëª¨ì„ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤."));
    
    // Lock ì ìš©
    Meetup lockedMeetup = meetupRepository.findByIdWithLock(meetupIdx)
        .orElseThrow(() -> new RuntimeException("ëª¨ì„ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤."));
    
    // ì¸ì› ì²´í¬ ë° ì¦ê°€ë¥¼ ì›ìì ìœ¼ë¡œ ì²˜ë¦¬
    if (lockedMeetup.getCurrentParticipants() >= lockedMeetup.getMaxParticipants()) {
        throw new RuntimeException("ëª¨ì„ ì¸ì›ì´ ê°€ë“ ì°¼ìŠµë‹ˆë‹¤.");
    }
    
    lockedMeetup.setCurrentParticipants(lockedMeetup.getCurrentParticipants() + 1);
    meetupRepository.save(lockedMeetup);
    
    // ... ì°¸ê°€ì ì¶”ê°€ ë¡œì§
}
```

**Repositoryì— ì¶”ê°€**:
```java
@Lock(LockModeType.PESSIMISTIC_WRITE)
@Query("SELECT m FROM Meetup m WHERE m.idx = :idx")
Optional<Meetup> findByIdWithLock(@Param("idx") Long idx);
```

#### 1.2 Optimistic Lock ì ìš© (ë” ë‚˜ì€ ì„±ëŠ¥)
```java
@Entity
public class Meetup {
    @Version
    private Long version; // Optimistic Lockìš© ë²„ì „ í•„ë“œ
    
    // ...
}
```

#### 1.3 DB ë ˆë²¨ ì œì•½ì¡°ê±´ ì¶”ê°€
```sql (ì ìš©)
ALTER TABLE meetup 
ADD CONSTRAINT chk_participants 
CHECK (current_participants <= max_participants);
```

### ğŸ“Š ì¸ë±ìŠ¤ ìµœì í™”

**í˜„ì¬ ì¸ë±ìŠ¤ ìƒíƒœ** (âœ… ëŒ€ë¶€ë¶„ ì´ë¯¸ ì ìš©ë¨):
```sql
-- meetup í…Œì´ë¸”
âœ… idx_meetup_date_status (date, status) - ì´ë¯¸ ì¡´ì¬
âœ… idx_meetup_location (latitude, longitude) - ì´ë¯¸ ì¡´ì¬
âœ… organizer_idx (organizer_idx) - ì´ë¯¸ ì¡´ì¬
âš ï¸ idx_meetup_date (date) - ë‹¨ì¼ ì¸ë±ìŠ¤, ë³µí•© ì¸ë±ìŠ¤ì™€ ì¤‘ë³µ ê°€ëŠ¥ì„±
âš ï¸ idx_meetup_status (status) - ë‹¨ì¼ ì¸ë±ìŠ¤, ë³µí•© ì¸ë±ìŠ¤ì™€ ì¤‘ë³µ ê°€ëŠ¥ì„±

-- meetup_participants í…Œì´ë¸”
âœ… PRIMARY KEY (meetup_idx, user_idx) - ì´ë¯¸ ì¡´ì¬ (ë³µí•© ê¸°ë³¸í‚¤)
âœ… user_idx (user_idx) - ì´ë¯¸ ì¡´ì¬
```

**ë¶„ì„ ê²°ê³¼**:
- âœ… í•„ìš”í•œ ì¸ë±ìŠ¤ëŠ” ëª¨ë‘ ì¡´ì¬í•¨
- âš ï¸ `idx_meetup_date`, `idx_meetup_status` ë‹¨ì¼ ì¸ë±ìŠ¤ëŠ” `idx_meetup_date_status` ë³µí•© ì¸ë±ìŠ¤ì™€ ì¤‘ë³µë  ìˆ˜ ìˆìŒ
  - ë³µí•© ì¸ë±ìŠ¤ê°€ ìˆìœ¼ë©´ ë‹¨ì¼ ì¸ë±ìŠ¤ëŠ” ë¶ˆí•„ìš”í•  ìˆ˜ ìˆìŒ (ì¿¼ë¦¬ íŒ¨í„´ì— ë”°ë¼ ë‹¤ë¦„)
  - `WHERE date = ?` ì¿¼ë¦¬ëŠ” ë³µí•© ì¸ë±ìŠ¤ë¡œë„ ì²˜ë¦¬ ê°€ëŠ¥
  - `WHERE status = ?` ì¿¼ë¦¬ëŠ” ë³µí•© ì¸ë±ìŠ¤ì˜ ë‘ ë²ˆì§¸ ì»¬ëŸ¼ì´ë¼ íš¨ê³¼ê°€ ë‚®ì„ ìˆ˜ ìˆìŒ

**ê¶Œì¥ ì‚¬í•­**:
- í˜„ì¬ ìƒíƒœë¡œë„ ì¶©ë¶„í•¨
- ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§ í›„ í•„ìš”ì‹œ ë‹¨ì¼ ì¸ë±ìŠ¤ ì œê±° ê³ ë ¤ (ë³µí•© ì¸ë±ìŠ¤ë§Œ ìœ ì§€)

**í˜„ì¬ ë¬¸ì œ**: `getNearbyMeetups()` ë©”ì„œë“œê°€ ì „ì²´ ëª¨ì„ì„ ì¡°íšŒ í›„ Javaì—ì„œ í•„í„°ë§ (line 158)
- **ê°œì„ **: DB ë ˆë²¨ì—ì„œ ê±°ë¦¬ ê³„ì‚° ë° í•„í„°ë§ (Haversine ê³µì‹)

### ğŸ”„ íŠ¸ëœì­ì…˜ ê°œì„  âœ… ì ìš© ì™„ë£Œ

**ë¬¸ì œ**: ì±„íŒ…ë°© ìƒì„± ì‹¤íŒ¨ ì‹œ ëª¨ì„ ìƒì„±ê¹Œì§€ ë¡¤ë°±í•˜ëŠ” ë¬¸ì œ

**ì„¤ê³„ ì›ì¹™**: **íŒŒìƒ ë„ë©”ì¸ì€ ì‹¤íŒ¨í•´ë„ í•µì‹¬ ë„ë©”ì¸ì„ ë¡¤ë°±í•˜ë©´ ì•ˆ ëœë‹¤.**

**í•´ê²°**: ì´ë²¤íŠ¸ ê¸°ë°˜ ì•„í‚¤í…ì²˜ë¡œ í•µì‹¬ ë„ë©”ì¸ê³¼ íŒŒìƒ ë„ë©”ì¸ ë¶„ë¦¬

**ì ìš© ì½”ë“œ**:

#### 1. ëª¨ì„ ìƒì„± (í•µì‹¬ ë„ë©”ì¸ - ë‹¨ë… íŠ¸ëœì­ì…˜)
```java
@Transactional
public MeetupDTO createMeetup(...) {
    Meetup savedMeetup = meetupRepository.save(meetup);
    
    // ì´ë²¤íŠ¸ ë°œí–‰ (íŠ¸ëœì­ì…˜ ì»¤ë°‹ í›„ ë¹„ë™ê¸° ì²˜ë¦¬)
    eventPublisher.publishEvent(new MeetupCreatedEvent(
            this,
            savedMeetup.getIdx(),
            organizer.getIdx(),
            savedMeetup.getTitle()
    ));
    
    return converter.toDTO(savedMeetup);
}
```

#### 2. ì±„íŒ…ë°© ìƒì„± (íŒŒìƒ ë„ë©”ì¸ - ë³„ë„ íŠ¸ëœì­ì…˜)
```java
@EventListener
@Async
@Transactional(propagation = Propagation.REQUIRES_NEW)
public void handleMeetupCreated(MeetupCreatedEvent event) {
    try {
        conversationService.createConversation(...);
        conversationService.setParticipantRole(...);
    } catch (Exception e) {
        // ì±„íŒ…ë°© ìƒì„± ì‹¤íŒ¨í•´ë„ ëª¨ì„ì€ ì´ë¯¸ ìƒì„±ë¨ (ë¡¤ë°±ë˜ì§€ ì•ŠìŒ)
        log.error("ì±„íŒ…ë°© ìƒì„± ì‹¤íŒ¨: meetupIdx={}", event.getMeetupIdx(), e);
    }
}
```

**íš¨ê³¼**:
- âœ… í•µì‹¬ ë„ë©”ì¸ ë³´ì¥: ëª¨ì„ ìƒì„±ì€ í•­ìƒ ì„±ê³µ (ì±„íŒ…ë°© ë¬¸ì œì™€ ë¬´ê´€)
- âœ… ì‚¬ìš©ì ê²½í—˜ ê°œì„ : ëª¨ì„ ìƒì„± ì¦‰ì‹œ ì‘ë‹µ, ì±„íŒ…ë°©ì€ ë¹„ë™ê¸° ìƒì„±
- âœ… í™•ì¥ì„±: ë‹¤ë¥¸ ë¶€ê°€ ê¸°ëŠ¥ë„ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆë¡œ ì¶”ê°€ ê°€ëŠ¥

**êµ¬í˜„ íŒŒì¼**:
- `MeetupCreatedEvent.java`: ì´ë²¤íŠ¸ í´ë˜ìŠ¤
- `MeetupChatRoomEventListener.java`: ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
- `MeetupService.java`: ì´ë²¤íŠ¸ ë°œí–‰ ë¡œì§

---

<!-- ==================================================================================================================== -->
<!-- =================================================================================================================================== -->
<!-- =================================================================================================================================== -->


## 2. ğŸ’¬ Chat (ì±„íŒ…) ë„ë©”ì¸ (ì´ê±°ëŠ” ì¢€ ë” ë¶„ì„ì´ í•„ìš” )

### âœ… ì´ë¯¸ ê°œì„ ë¨: unreadCount ì¦ê°€

**ìœ„ì¹˜**: `ChatMessageService.sendMessage()` (line 87)

**í˜„ì¬ ìƒíƒœ**: ì›ìì  ì¿¼ë¦¬ë¡œ Lost Update ë°©ì§€
```java
participantRepository.incrementUnreadCount(conversationIdx, senderIdx);
```

### âš ï¸ ì ì¬ì  ë¬¸ì œ: ë©”ì‹œì§€ ì½ìŒ ì²˜ë¦¬

**ìœ„ì¹˜**: `ChatMessageService.markAsRead()` (line 149-190)

**ë¬¸ì œì  ë¶„ì„**:

#### 1. ë¹„íš¨ìœ¨ì ì¸ ì „ì²´ ë©”ì‹œì§€ ì¡°íšŒ
```java
// âš ï¸ ë¬¸ì œ: ì „ì²´ ë©”ì‹œì§€ë¥¼ ì¡°íšŒí•˜ê³  Javaì—ì„œ í•„í„°ë§
List<ChatMessage> unreadMessages = chatMessageRepository
    .findByConversationIdxOrderByCreatedAtDesc(conversationIdx)  // ì „ì²´ ì¡°íšŒ!
    .stream()
    .filter(m -> m.getCreatedAt().isBefore(...) && !m.getSender().getIdx().equals(userId))
    .collect(Collectors.toList());
```
- **ë¬¸ì œ**: ì±„íŒ…ë°©ì˜ ëª¨ë“  ë©”ì‹œì§€ë¥¼ ì¡°íšŒ í›„ Javaì—ì„œ í•„í„°ë§
- **ì˜í–¥**: ë©”ì‹œì§€ê°€ ë§ì„ìˆ˜ë¡ ì„±ëŠ¥ ì €í•˜ (ìˆ˜ì²œ~ìˆ˜ë§Œ ê±´ ì¡°íšŒ)
- **í˜„ì¬ ìƒíƒœ**: MessageReadStatus ê¸°ë¡ ë¡œì§ì€ ì£¼ì„ ì²˜ë¦¬ë˜ì–´ ìˆìŒ (ì‹¤ì œ ì‚¬ìš© ì•ˆ í•¨)

#### 2. í”„ë¡ íŠ¸ì—”ë“œì—ì„œ ë¹ˆë²ˆí•œ í˜¸ì¶œ
**ìœ„ì¹˜**: `ChatRoom.js`
- **í˜¸ì¶œ ì‹œì **:
  - ë©”ì‹œì§€ ì¡°íšŒ í›„ (line 56)
  - WebSocketìœ¼ë¡œ ìƒˆ ë©”ì‹œì§€ ìˆ˜ì‹  ì‹œ (line 170)
  - ì´ë¯¸ì§€ ì „ì†¡ í›„ (line 243, 248)
  - í…ìŠ¤íŠ¸ ë©”ì‹œì§€ ì „ì†¡ í›„ (line 287, 292)
- **ë¬¸ì œ**: ì½ìŒ ì²˜ë¦¬ê°€ ë§¤ìš° ë¹ˆë²ˆí•˜ê²Œ ë°œìƒ â†’ DB ë¶€í•˜ ì¦ê°€ ê°€ëŠ¥

#### 3. íŠ¸ëœì­ì…˜ ë²”ìœ„ê°€ ë„“ìŒ
- ì°¸ì—¬ì ì¡°íšŒ â†’ ë©”ì‹œì§€ ì¡°íšŒ â†’ í•„í„°ë§ â†’ ë°˜ë³µ ì²˜ë¦¬
- ë¶ˆí•„ìš”í•œ ë¡œì§ í¬í•¨ (MessageReadStatusëŠ” ì‚¬ìš© ì•ˆ í•¨)

**ê°œì„  ë°©ì•ˆ**:

1. **ë¶ˆí•„ìš”í•œ ë¡œì§ ì œê±°**: MessageReadStatus ê¸°ë¡ ë¡œì§ ì œê±° (ì‚¬ìš© ì•ˆ í•¨)
2. **ì½ìŒ ì²˜ë¦¬ ë‹¨ìˆœí™”**: `unreadCount = 0` ë° `lastReadMessage`ë§Œ ì—…ë°ì´íŠ¸
3. **í”„ë¡ íŠ¸ì—”ë“œ ìµœì í™”**: ì½ìŒ ì²˜ë¦¬ í˜¸ì¶œ ë¹ˆë„ ê°ì†Œ (ë””ë°”ìš´ì‹± ì ìš©)
4. **ë°°ì¹˜ ì²˜ë¦¬**: ì—¬ëŸ¬ ì±„íŒ…ë°©ì˜ ì½ìŒ ì²˜ë¦¬ë¥¼ í•œ ë²ˆì— ì²˜ë¦¬

### ğŸ“Š ì¸ë±ìŠ¤ ìµœì í™”

**í˜„ì¬ ì¿¼ë¦¬ íŒ¨í„´ ë¶„ì„**:
- `findByConversationIdxOrderByCreatedAtDesc`: conversation_idx + created_at ì‚¬ìš©
- `findByConversationIdxAndCreatedAtBeforeOrderByCreatedAtDesc`: conversation_idx + created_at ì‚¬ìš©
- `findByConversationIdxAndCreatedAtAfterOrderByCreatedAtDesc`: conversation_idx + created_at ì‚¬ìš©
- `findByConversationIdxAndUserIdx`: conversation_idx + user_idx ì‚¬ìš©

**í•„ìš”í•œ ì¸ë±ìŠ¤**:
```sql
-- ë©”ì‹œì§€ ì¡°íšŒ ì„±ëŠ¥ í–¥ìƒ (ê°€ì¥ ì¤‘ìš”)
CREATE INDEX idx_chat_message_conversation_created ON chat_message(conversation_idx, created_at DESC);
CREATE INDEX idx_chat_message_sender ON chat_message(sender_idx);
CREATE INDEX idx_chat_message_deleted ON chat_message(is_deleted); -- Soft Delete í•„í„°ë§

-- ì°¸ê°€ì ì¡°íšŒ ì„±ëŠ¥ í–¥ìƒ
CREATE INDEX idx_conversation_participant_conversation ON conversation_participant(conversation_idx);
CREATE INDEX idx_conversation_participant_user ON conversation_participant(user_idx);
CREATE INDEX idx_conversation_participant_status ON conversation_participant(status, unread_count);
CREATE UNIQUE INDEX idx_conversation_participant_unique ON conversation_participant(conversation_idx, user_idx);

-- ì½ìŒ ìƒíƒœ ì¡°íšŒ (í˜„ì¬ ì‚¬ìš© ì•ˆ í•˜ì§€ë§Œ, í–¥í›„ ì‚¬ìš© ì‹œ)
CREATE INDEX idx_message_read_status_message ON message_read_status(message_idx);
CREATE INDEX idx_message_read_status_user ON message_read_status(user_idx);
CREATE UNIQUE INDEX idx_message_read_status_unique ON message_read_status(message_idx, user_idx);
```

**ì¸ë±ìŠ¤ ìš°ì„ ìˆœìœ„**:
1. **ë†’ìŒ**: `idx_chat_message_conversation_created` (ê°€ì¥ ìì£¼ ì‚¬ìš©)
2. **ë†’ìŒ**: `idx_conversation_participant_unique` (ì¤‘ë³µ ë°©ì§€ + ì¡°íšŒ ì„±ëŠ¥)
3. **ì¤‘ê°„**: `idx_chat_message_sender`, `idx_conversation_participant_conversation`
4. **ë‚®ìŒ**: MessageReadStatus ê´€ë ¨ (í˜„ì¬ ì‚¬ìš© ì•ˆ í•¨)

### ğŸ”„ ìë£Œêµ¬ì¡°/ì•Œê³ ë¦¬ì¦˜ ì ìš©

**í˜„ì¬**: ë©”ì‹œì§€ ì¡°íšŒ ì‹œ í˜ì´ì§• ì‚¬ìš© (line 104-130)
- âœ… ì»¤ì„œ ê¸°ë°˜ í˜ì´ì§• êµ¬í˜„ë¨ (`getMessagesBefore()`)
- **ê°œì„ **: í”„ë¡ íŠ¸ì—”ë“œì—ì„œ ì»¤ì„œ ê¸°ë°˜ í˜ì´ì§• í™œìš© ê¶Œì¥

**ì°¸ê³ **: ìƒì„¸ ë‚´ìš©ì€ `docs/troubleshooting/chat/read-status-performance.md` ì°¸ì¡°

---

<!-- =================================================================================================================================== -->
<!-- =================================================================================================================================== -->
<!-- =================================================================================================================================== -->


## 3. ğŸ‘¤ User (ì‚¬ìš©ì) ë„ë©”ì¸ (í•´ê²°)

### âš ï¸ ê°€ì¥ ì‹¬ê°í•œ ë¬¸ì œ: ë‹‰ë„¤ì„ ì¤‘ë³µ ì²´í¬ Race Condition

**ìœ„ì¹˜**: `UsersService.createUser()`, `UsersService.updateMyUsername()`, `UsersService.setNickname()`

**ë¬¸ì œ ìƒí™©**:
```java
// UsersService.java:107-110
usersRepository.findByNickname(nickname)
    .ifPresent(existingUser -> {
        throw new RuntimeException("ì´ë¯¸ ì‚¬ìš© ì¤‘ì¸ ë‹‰ë„¤ì„ì…ë‹ˆë‹¤.");
    });
// ... 
Users saved = usersRepository.save(user); // âš ï¸ ì´ ì‚¬ì´ì— ë‹¤ë¥¸ ìš”ì²­ì´ ê°™ì€ ë‹‰ë„¤ì„ìœ¼ë¡œ ê°€ì… ê°€ëŠ¥!
```

**ì‹œë‚˜ë¦¬ì˜¤**:
- ë™ì‹œì— 2ëª…ì´ ê°™ì€ ë‹‰ë„¤ì„ìœ¼ë¡œ ê°€ì… ì‹œë„
- ë‘˜ ë‹¤ ì¤‘ë³µ ì²´í¬ í†µê³¼
- ë‘˜ ë‹¤ ê°€ì… ì„±ê³µ â†’ ë‹‰ë„¤ì„ ì¤‘ë³µ ë°œìƒ!

**í•´ê²° ë°©ì•ˆ**:

#### 3.1 DB ë ˆë²¨ Unique ì œì•½ì¡°ê±´ (ê°€ì¥ í™•ì‹¤)
```java
@Entity
@Table(name = "users", 
    uniqueConstraints = @UniqueConstraint(columnNames = {"nickname"}))
public class Users {
    @Column(length = 50, unique = true) // âœ… ì´ë¯¸ ìˆìŒ!
    private String nickname;
}
```

**í˜„ì¬ ìƒíƒœ**: `Users.java:30`ì— ì´ë¯¸ `unique = true` ì„¤ì •ë¨
- **ë¬¸ì œ**: ì˜ˆì™¸ ì²˜ë¦¬ í•„ìš”
```java
@Transactional
public UsersDTO createUser(UsersDTO dto) {
    try {
        // ... ì¤‘ë³µ ì²´í¬
        Users saved = usersRepository.save(user);
        return usersConverter.toDTO(saved);
    } catch (DataIntegrityViolationException e) {
        if (e.getMessage().contains("nickname")) {
            throw new RuntimeException("ì´ë¯¸ ì‚¬ìš© ì¤‘ì¸ ë‹‰ë„¤ì„ì…ë‹ˆë‹¤.");
        }
        throw e;
    }
}
```

#### 3.2 Pessimistic Lock ì ìš©
```java
@Lock(LockModeType.PESSIMISTIC_WRITE)
Optional<Users> findByNicknameForUpdate(String nickname);
```

### ğŸ“Š ì¸ë±ìŠ¤ ìµœì í™”

**í•„ìš”í•œ ì¸ë±ìŠ¤**:
```sql
-- ì‚¬ìš©ì ì¡°íšŒ ì„±ëŠ¥ í–¥ìƒ (ì´ë¯¸ unique ì œì•½ì¡°ê±´ìœ¼ë¡œ ì¸ë±ìŠ¤ ìƒì„±ë¨)
-- CREATE UNIQUE INDEX idx_users_id ON users(id);
-- CREATE UNIQUE INDEX idx_users_username ON users(username);
-- CREATE UNIQUE INDEX idx_users_nickname ON users(nickname);
-- CREATE UNIQUE INDEX idx_users_email ON users(email);

-- ì¶”ê°€ ì¸ë±ìŠ¤
CREATE INDEX idx_users_status ON users(status);
CREATE INDEX idx_users_deleted ON users(is_deleted, deleted_at);
CREATE INDEX idx_users_location ON users(location); -- ìœ„ì¹˜ ê¸°ë°˜ ê²€ìƒ‰
```

### âš ï¸ íƒˆí‡´í•œ ì‚¬ìš©ì(Soft Delete)ì˜ ë‹‰ë„¤ì„/username/email ì¬ì‚¬ìš© ë¶ˆê°€ ë¬¸ì œ

**ìœ„ì¹˜**: `UsersRepository.findByNickname()`, `findByUsername()`, `findByEmail()`  
**ì˜í–¥ë°›ëŠ” ë©”ì„œë“œ**: `createUser()`, `updateMyProfile()`, `updateMyUsername()`, `setNickname()`, `updateUser()`

**ë¬¸ì œ ìƒí™©**:
```java
// UsersRepository.java
Optional<Users> findByNickname(String nickname);  // âš ï¸ isDeleted í•„í„°ë§ ì—†ìŒ!
Optional<Users> findByUsername(String username);  // âš ï¸ isDeleted í•„í„°ë§ ì—†ìŒ!
Optional<Users> findByEmail(String email);        // âš ï¸ isDeleted í•„í„°ë§ ì—†ìŒ!

// UsersService.java:107-110
usersRepository.findByNickname(nickname)
    .ifPresent(existingUser -> {
        throw new RuntimeException("ì´ë¯¸ ì‚¬ìš© ì¤‘ì¸ ë‹‰ë„¤ì„ì…ë‹ˆë‹¤.");
    });
// âš ï¸ íƒˆí‡´í•œ ì‚¬ìš©ìë„ ì¡°íšŒë¨!
```

**ì‹œë‚˜ë¦¬ì˜¤**:
1. ì‚¬ìš©ì Aê°€ "nickname1"ë¡œ ê°€ì… â†’ ì„±ê³µ
2. ì‚¬ìš©ì Aê°€ íƒˆí‡´ (`isDeleted = true`)
3. ì‚¬ìš©ì Bê°€ "nickname1"ë¡œ ê°€ì… ì‹œë„
4. `findByNickname("nickname1")`ì´ íƒˆí‡´í•œ ì‚¬ìš©ì Aë¥¼ ë°˜í™˜
5. ì¤‘ë³µ ì²´í¬ì—ì„œ ê±¸ë ¤ì„œ ê°€ì… ì‹¤íŒ¨ âŒ
6. **ê²°ê³¼**: íƒˆí‡´í•œ ì‚¬ìš©ìì˜ ë‹‰ë„¤ì„ì„ ë‹¤ë¥¸ ì‚¬ìš©ìê°€ ì¬ì‚¬ìš©í•  ìˆ˜ ì—†ìŒ!

**ì˜í–¥**:
- íƒˆí‡´í•œ ì‚¬ìš©ìì˜ ë‹‰ë„¤ì„/username/emailì´ ì˜êµ¬íˆ ì‚¬ìš© ë¶ˆê°€ëŠ¥
- ì‚¬ìš©ìê°€ íƒˆí‡´ í›„ ì¬ê°€ì… ì‹œ ê¸°ì¡´ ë‹‰ë„¤ì„ ì‚¬ìš© ë¶ˆê°€
- ë‹‰ë„¤ì„ ê³ ê°ˆ ê°€ëŠ¥ì„± (íŠ¹íˆ ì§§ì€/ì¸ê¸° ìˆëŠ” ë‹‰ë„¤ì„)

**í•´ê²° ë°©ì•ˆ**:

#### 3.3 Repository ë©”ì„œë“œì— isDeleted í•„í„°ë§ ì¶”ê°€
```java
// UsersRepository.java
@Query("SELECT u FROM Users u WHERE u.nickname = :nickname AND (u.isDeleted = false OR u.isDeleted IS NULL)")
Optional<Users> findByNicknameAndNotDeleted(@Param("nickname") String nickname);

@Query("SELECT u FROM Users u WHERE u.username = :username AND (u.isDeleted = false OR u.isDeleted IS NULL)")
Optional<Users> findByUsernameAndNotDeleted(@Param("username") String username);

@Query("SELECT u FROM Users u WHERE u.email = :email AND (u.isDeleted = false OR u.isDeleted IS NULL)")
Optional<Users> findByEmailAndNotDeleted(@Param("email") String email);
```

ë˜ëŠ” ê¸°ì¡´ ë©”ì„œë“œë¥¼ ìˆ˜ì •:
```java
@Query("SELECT u FROM Users u WHERE u.nickname = :nickname")
Optional<Users> findByNickname(@Param("nickname") String nickname);

// ì„œë¹„ìŠ¤ì—ì„œ í•„í„°ë§
public UsersDTO createUser(UsersDTO dto) {
    usersRepository.findByNickname(dto.getNickname())
        .filter(user -> !Boolean.TRUE.equals(user.getIsDeleted()))  // âœ… íƒˆí‡´í•œ ì‚¬ìš©ì ì œì™¸
        .ifPresent(existingUser -> {
            throw new RuntimeException("ì´ë¯¸ ì‚¬ìš© ì¤‘ì¸ ë‹‰ë„¤ì„ì…ë‹ˆë‹¤.");
        });
    // ...
}
```

**ê¶Œì¥ í•´ê²°ì±…**: Repository ë©”ì„œë“œì— ëª…ì‹œì ìœ¼ë¡œ `isDeleted = false` ì¡°ê±´ ì¶”ê°€
- ì½”ë“œ ì¼ê´€ì„± ìœ ì§€
- ì‹¤ìˆ˜ë¡œ íƒˆí‡´í•œ ì‚¬ìš©ìë¥¼ ì¡°íšŒí•˜ëŠ” ê²ƒì„ ë°©ì§€
- ëª¨ë“  ì¤‘ë³µ ì²´í¬ ë¡œì§ì—ì„œ ìë™ìœ¼ë¡œ ì ìš©

### ğŸ”„ íŠ¸ëœì­ì…˜ ê°œì„ 

**í˜„ì¬**: `@Transactional` í´ë˜ìŠ¤ ë ˆë²¨ ì ìš© (line 28)
- **ë¬¸ì œ**: ì½ê¸° ì „ìš© ë©”ì„œë“œë„ ì“°ê¸° íŠ¸ëœì­ì…˜ì— í¬í•¨
- **ê°œì„ **: ì½ê¸° ì „ìš© ë©”ì„œë“œì— `@Transactional(readOnly = true)` ëª…ì‹œ

---

<!-- =================================================================================================================================== -->
<!-- =================================================================================================================================== -->
<!-- =================================================================================================================================== -->


## 4. ğŸ“ Board (ê²Œì‹œíŒ) ë„ë©”ì¸

---

## âœ… í•´ê²° ì™„ë£Œëœ ì„±ëŠ¥ ìµœì í™” í•­ëª©

### 1. N+1 ë¬¸ì œ í•´ê²°: ë°°ì¹˜ ì¡°íšŒë¡œ ë°˜ì‘ ì •ë³´ ì¡°íšŒ ìµœì í™”

**ë¬¸ì œ ìƒí™©**:
- ê²Œì‹œê¸€ ëª©ë¡ ì¡°íšŒ ì‹œ ê° ê²Œì‹œê¸€ë§ˆë‹¤ ì¢‹ì•„ìš”/ì‹«ì–´ìš” ì¹´ìš´íŠ¸ë¥¼ ê°œë³„ ì¿¼ë¦¬ë¡œ ì¡°íšŒ
- 1000ê°œ ê²Œì‹œê¸€ ê¸°ì¤€: 1ê°œ (ê²Œì‹œê¸€) + 2000ê°œ (ì¢‹ì•„ìš”/ì‹«ì–´ìš”) = **2001ê°œ ì¿¼ë¦¬**
- ì¡°íšŒ ì‹œê°„: ~30ì´ˆ

**í•´ê²° ë°©ë²•**:
- ë°°ì¹˜ ì¡°íšŒë¡œ IN ì ˆì„ í™œìš©í•œ ì§‘ê³„ ì¿¼ë¦¬ ì‚¬ìš©
- 500ê°œ ë‹¨ìœ„ë¡œ ë°°ì¹˜ ì²˜ë¦¬í•˜ì—¬ IN ì ˆ í¬ê¸° ì œí•œ

**êµ¬í˜„ ë‚´ìš©**:
```java
// BoardService.java
private List<BoardDTO> mapBoardsWithReactionsBatch(List<Board> boards) {
    // 1. ê²Œì‹œê¸€ ID ëª©ë¡ ì¶”ì¶œ
    List<Long> boardIds = boards.stream()
        .map(Board::getIdx)
        .collect(Collectors.toList());
    
    // 2. ì¢‹ì•„ìš”/ì‹«ì–´ìš” ì¹´ìš´íŠ¸ ë°°ì¹˜ ì¡°íšŒ (IN ì ˆ)
    Map<Long, Map<ReactionType, Long>> reactionCountsMap = getReactionCountsBatch(boardIds);
    
    // 3. ê²Œì‹œê¸€ DTO ë³€í™˜ ë° ë°˜ì‘ ì •ë³´ ë§¤í•‘
    return boards.stream()
        .map(board -> {
            BoardDTO dto = boardConverter.toDTO(board);
            Map<ReactionType, Long> counts = reactionCountsMap.getOrDefault(board.getIdx(), new HashMap<>());
            dto.setLikes(Math.toIntExact(counts.getOrDefault(LIKE, 0L)));
            dto.setDislikes(Math.toIntExact(counts.getOrDefault(DISLIKE, 0L)));
            return dto;
        })
        .collect(Collectors.toList());
}

private Map<Long, Map<ReactionType, Long>> getReactionCountsBatch(List<Long> boardIds) {
    final int BATCH_SIZE = 500;  // IN ì ˆ í¬ê¸° ì œí•œ
    Map<Long, Map<ReactionType, Long>> countsMap = new HashMap<>();
    
    // IN ì ˆì„ 500ê°œ ë‹¨ìœ„ë¡œ ë‚˜ëˆ„ì–´ ì¡°íšŒ
    for (int i = 0; i < boardIds.size(); i += BATCH_SIZE) {
        int end = Math.min(i + BATCH_SIZE, boardIds.size());
        List<Long> batch = boardIds.subList(i, end);
        
        List<Object[]> results = boardReactionRepository.countByBoardsGroupByReactionType(batch);
        // ê²°ê³¼ íŒŒì‹± ë° Map êµ¬ì„±
    }
    
    return countsMap;
}
```

**Repository ì¿¼ë¦¬**:
```java
// BoardReactionRepository.java
@Query("SELECT br.board.idx, br.reactionType, COUNT(br) " +
       "FROM BoardReaction br " +
       "WHERE br.board.idx IN :boardIds " +
       "GROUP BY br.board.idx, br.reactionType")
List<Object[]> countByBoardsGroupByReactionType(@Param("boardIds") List<Long> boardIds);
```

**íš¨ê³¼**:
- 1000ê°œ ê²Œì‹œê¸€ ê¸°ì¤€: 2001ê°œ ì¿¼ë¦¬ â†’ **3ê°œ ì¿¼ë¦¬** (99.8% ê°ì†Œ)
- ì¡°íšŒ ì‹œê°„: ~30ì´ˆ â†’ **~0.3ì´ˆ** (100ë°° ê°œì„ )

**ì½”ë“œ ìœ„ì¹˜**:
- `BoardService.mapBoardsWithReactionsBatch()` (line 518-551)
- `BoardService.getReactionCountsBatch()` (line 558-580)
- `BoardReactionRepository.countByBoardsGroupByReactionType()` (line 27-31)

---

### 2. N+1 ë¬¸ì œ í•´ê²°: Fetch Joinìœ¼ë¡œ ì‘ì„±ì ì •ë³´ ì¡°íšŒ ìµœì í™”

**ë¬¸ì œ ìƒí™©**:
- ê²Œì‹œê¸€ ì¡°íšŒ ì‹œ LAZY ë¡œë”©ìœ¼ë¡œ ì¸í•´ ì‘ì„±ì ì •ë³´ë¥¼ ê°œë³„ ì¿¼ë¦¬ë¡œ ì¡°íšŒ
- 100ê°œ ê²Œì‹œê¸€ ì¡°íšŒ ì‹œ ì‘ì„±ì ì •ë³´ë„ 100ë²ˆ ì¿¼ë¦¬ ë°œìƒ

**í•´ê²° ë°©ë²•**:
- ëª¨ë“  ê²Œì‹œê¸€ ì¡°íšŒ ì¿¼ë¦¬ì— `JOIN FETCH b.user` ì ìš©
- ì‘ì„±ì ì •ë³´ë¥¼ í•œ ë²ˆì˜ ì¿¼ë¦¬ë¡œ í•¨ê»˜ ì¡°íšŒ

**êµ¬í˜„ ë‚´ìš©**:
```java
// BoardRepository.java
@Query("SELECT b FROM Board b JOIN FETCH b.user u " +
       "WHERE b.isDeleted = false AND u.isDeleted = false AND u.status = 'ACTIVE' " +
       "ORDER BY b.createdAt DESC")
List<Board> findAllByIsDeletedFalseOrderByCreatedAtDesc();

@Query("SELECT b FROM Board b JOIN FETCH b.user u " +
       "WHERE b.category = :category AND b.isDeleted = false " +
       "AND u.isDeleted = false AND u.status = 'ACTIVE' " +
       "ORDER BY b.createdAt DESC")
List<Board> findByCategoryAndIsDeletedFalseOrderByCreatedAtDesc(@Param("category") String category);
```

**íš¨ê³¼**:
- 100ê°œ ê²Œì‹œê¸€ ì¡°íšŒ ì‹œ: 101ê°œ ì¿¼ë¦¬ â†’ **1ê°œ ì¿¼ë¦¬** (99% ê°ì†Œ)
- ì „ì²´ í”„ë¡œì íŠ¸ì—ì„œ 52ê°œ ì´ìƒì˜ JOIN FETCH/EntityGraph ì‚¬ìš©

**ì½”ë“œ ìœ„ì¹˜**:
- `BoardRepository` ì „ì²´ ì¡°íšŒ ë©”ì„œë“œ (line 24-100)

---

### 3. ì¸ê¸°ê¸€ ìŠ¤ëƒ…ìƒ· ìƒì„±ìœ¼ë¡œ ë³µì¡í•œ ê³„ì‚° ìµœì í™”

**ë¬¸ì œ ìƒí™©**:
- ì¸ê¸°ê¸€ ì¡°íšŒ ì‹œë§ˆë‹¤ ë³µì¡í•œ ì¸ê¸°ë„ ì ìˆ˜ ê³„ì‚° (ì¡°íšŒìˆ˜*0.1 + ì¢‹ì•„ìš”*2 + ëŒ“ê¸€*1.5)
- ë§¤ë²ˆ ì „ì²´ ê²Œì‹œê¸€ì„ ì¡°íšŒí•˜ê³  ì •ë ¬í•˜ì—¬ ì„±ëŠ¥ ì €í•˜
- ì¡°íšŒ ì‹œê°„: ~5ì´ˆ

**í•´ê²° ë°©ë²•**:
- ìŠ¤ì¼€ì¤„ëŸ¬ë¥¼ í†µí•´ ì¸ê¸°ê¸€ ìŠ¤ëƒ…ìƒ·ì„ ë¯¸ë¦¬ ìƒì„±í•˜ì—¬ ì €ì¥
- ì¡°íšŒ ì‹œì—ëŠ” ìŠ¤ëƒ…ìƒ·ì—ì„œ ë°”ë¡œ ì¡°íšŒ

**êµ¬í˜„ ë‚´ìš©**:
```java
// BoardPopularityScheduler.java
@Scheduled(cron = "0 30 18 * * ?")  // ë§¤ì¼ ì˜¤í›„ 6ì‹œ 30ë¶„
@Transactional
public void generateWeeklyPopularitySnapshots() {
    log.info("ì£¼ê°„ ì¸ê¸° ê²Œì‹œê¸€ ìŠ¤ëƒ…ìƒ· ìƒì„± ì‹œì‘");
    boardPopularityService.generateSnapshots(PopularityPeriodType.WEEKLY);
    log.info("ì£¼ê°„ ì¸ê¸° ê²Œì‹œê¸€ ìŠ¤ëƒ…ìƒ· ìƒì„± ì™„ë£Œ");
}

@Scheduled(cron = "0 30 18 ? * MON")  // ë§¤ì£¼ ì›”ìš”ì¼ ì˜¤í›„ 6ì‹œ 30ë¶„
@Transactional
public void generateMonthlyPopularitySnapshots() {
    log.info("ì›”ê°„ ì¸ê¸° ê²Œì‹œê¸€ ìŠ¤ëƒ…ìƒ· ìƒì„± ì‹œì‘");
    boardPopularityService.generateSnapshots(PopularityPeriodType.MONTHLY);
    log.info("ì›”ê°„ ì¸ê¸° ê²Œì‹œê¸€ ìŠ¤ëƒ…ìƒ· ìƒì„± ì™„ë£Œ");
}
```

**íš¨ê³¼**:
- ì‹¤ì‹œê°„ ê³„ì‚°: ~5ì´ˆ â†’ ìŠ¤ëƒ…ìƒ· ì¡°íšŒ: **~0.01ì´ˆ** (500ë°° ê°œì„ )
- DB ë¶€ë‹´ ê°ì†Œ
- ìºì‹±ê³¼ ê²°í•© ì‹œ ë”ìš± ë¹ ë¥¸ ì‘ë‹µ

**ì½”ë“œ ìœ„ì¹˜**:
- `BoardPopularityScheduler.generateWeeklyPopularitySnapshots()` (line 20-31)
- `BoardPopularityScheduler.generateMonthlyPopularitySnapshots()` (line 36-47)
- `BoardPopularityService.generateSnapshots()`

---

### 4. FULLTEXT ì¸ë±ìŠ¤ë¡œ ê²€ìƒ‰ ì„±ëŠ¥ ìµœì í™”

**ë¬¸ì œ ìƒí™©**:
- LIKE ê²€ìƒ‰ì€ ì¸ë±ìŠ¤ë¥¼ í™œìš©í•˜ì§€ ëª»í•˜ì—¬ ì „ì²´ í…Œì´ë¸” ìŠ¤ìº”
- í•œê¸€ ê²€ìƒ‰ ì‹œ í˜•íƒœì†Œ ë¶„ì„ ë¶€ì¡±ìœ¼ë¡œ ê²€ìƒ‰ ëˆ„ë½ ê°€ëŠ¥

**í•´ê²° ë°©ë²•**:
- MySQL FULLTEXT ì¸ë±ìŠ¤ ì‚¬ìš© (ngram íŒŒì„œ)
- relevance ì ìˆ˜ ê¸°ë°˜ ì •ë ¬

**êµ¬í˜„ ë‚´ìš©**:
```sql
-- ì¸ë±ìŠ¤ ìƒì„±
CREATE FULLTEXT INDEX idx_board_title_content 
ON board(title, content) WITH PARSER ngram;
```

```java
// BoardRepository.java
@Query(value = "SELECT b.*, " +
               "MATCH(b.title, b.content) AGAINST(:kw IN BOOLEAN MODE) as relevance " +
               "FROM board b " +
               "INNER JOIN users u ON b.user_idx = u.idx " +
               "WHERE b.is_deleted = false " +
               "AND u.is_deleted = false " +
               "AND u.status = 'ACTIVE' " +
               "AND MATCH(b.title, b.content) AGAINST(:kw IN BOOLEAN MODE) " +
               "ORDER BY relevance DESC, b.created_at DESC", 
       nativeQuery = true)
Page<Board> searchByKeywordWithPaging(@Param("kw") String keyword, Pageable pageable);
```

**íš¨ê³¼**:
- LIKE ê²€ìƒ‰ ëŒ€ë¹„ **10ë°° ì´ìƒ ë¹ ë¥¸ ê²€ìƒ‰ ì†ë„**
- í•œê¸€ ê²€ìƒ‰ ì •í™•ë„ í–¥ìƒ (ngram íŒŒì„œ)
- relevance ì ìˆ˜ ê¸°ë°˜ ì •ë ¬ë¡œ ê²€ìƒ‰ ê²°ê³¼ í’ˆì§ˆ í–¥ìƒ

**ì½”ë“œ ìœ„ì¹˜**:
- `BoardRepository.searchByKeywordWithPaging()` (line 66-80)
- ì¸ë±ìŠ¤: `docs/migration/db/indexes.sql` (line 38)

---

### 5. ê¸°ë³¸ ì¸ë±ì‹± ì „ëµ ì ìš©

**ì ìš©ëœ ì¸ë±ìŠ¤**:
```sql
-- ê²Œì‹œê¸€ ì¡°íšŒ ì„±ëŠ¥ í–¥ìƒ
CREATE INDEX idx_board_created_at ON board(created_at);
CREATE INDEX idx_board_category_created_at ON board(category, created_at);
CREATE INDEX idx_board_user_idx_created_at ON board(user_idx, created_at);
CREATE FULLTEXT INDEX idx_board_title_content ON board(title, content) WITH PARSER ngram;

-- ëŒ“ê¸€ ì¡°íšŒ ì„±ëŠ¥ í–¥ìƒ
CREATE INDEX idx_comment_board_deleted_created ON comment(board_idx, is_deleted, created_at ASC);
CREATE INDEX idx_comment_user ON comment(user_idx);

-- ë°˜ì‘ ì¡°íšŒ ì„±ëŠ¥ í–¥ìƒ
CREATE INDEX idx_board_reaction_board_type ON board_reaction(board_idx, reaction_type);
CREATE INDEX idx_board_reaction_user ON board_reaction(user_idx);
CREATE UNIQUE INDEX idx_board_reaction_unique ON board_reaction(board_idx, user_idx);

-- ì¡°íšŒìˆ˜ ë¡œê·¸
CREATE INDEX idx_board_view_log_board ON board_view_log(board_idx);
CREATE INDEX idx_board_view_log_user ON board_view_log(user_idx);
CREATE UNIQUE INDEX idx_board_view_log_unique ON board_view_log(board_idx, user_idx);
```

**íš¨ê³¼**:
- ì¿¼ë¦¬ ì‹¤í–‰ ê³„íš ìµœì í™”
- ë¶ˆí•„ìš”í•œ í…Œì´ë¸” ìŠ¤ìº” ë°©ì§€
- ì •ë ¬ ë° í•„í„°ë§ ì„±ëŠ¥ í–¥ìƒ

**ì½”ë“œ ìœ„ì¹˜**:
- `docs/migration/db/indexes.sql`

---

## âš ï¸ ê°œì„  í•„ìš” í•­ëª©

### âš ï¸ ë¶€ë¶„ ì ìš©: ìºì‹± ì „ëµ

**í˜„ì¬ ìƒíƒœ**:
- âœ… `@Cacheable(value = "boardDetail")`: ê²Œì‹œê¸€ ìƒì„¸ ì¡°íšŒ ìºì‹± ì ìš©
- âœ… `@CacheEvict`: ê²Œì‹œê¸€ ìƒì„±/ìˆ˜ì •/ì‚­ì œ ì‹œ ìºì‹œ ë¬´íš¨í™”
- âŒ `getAllBoards()` ìºì‹œëŠ” ì£¼ì„ ì²˜ë¦¬ë¨ (ê°œë°œ ì¤‘ ë°ì´í„° ë™ê¸°í™” ë¬¸ì œ)

**ì½”ë“œ ìœ„ì¹˜**:
```java
// BoardService.java
@Cacheable(value = "boardDetail", key = "#idx")
public BoardDTO getBoard(long idx, Long viewerId) { ... }

@CacheEvict(value = "boardList", allEntries = true)
public BoardDTO createBoard(BoardDTO dto) { ... }

// ì£¼ì„ ì²˜ë¦¬ë¨
// @Cacheable(value = "boardList", key = "#category != null ? #category : 'ALL'")
public List<BoardDTO> getAllBoards(String category) { ... }
```

**ê°œì„  í•„ìš” ì‚¬í•­**:
1. **Redis ìºì‹œë¡œ ì „í™˜**: í˜„ì¬ Spring Cache (ë¡œì»¬ ë©”ëª¨ë¦¬) ì‚¬ìš©
   - ì—¬ëŸ¬ ì„œë²„ ì¸ìŠ¤í„´ìŠ¤ ì‹œ ìºì‹œ ë¶ˆì¼ì¹˜ ë¬¸ì œ
   - ì„œë²„ ì¬ì‹œì‘ ì‹œ ìºì‹œ ì†Œì‹¤
   - Redisë¡œ ì „í™˜í•˜ì—¬ í•´ê²° ê°€ëŠ¥

2. **ê²Œì‹œê¸€ ëª©ë¡ ìºì‹œ ì¬í™œì„±í™”**: ë°ì´í„° ë™ê¸°í™” ë¬¸ì œ í•´ê²° í›„ ì¬í™œì„±í™”

### âš ï¸ ì ì¬ì  ë¬¸ì œ: ì¡°íšŒìˆ˜ ì¦ê°€ Race Condition

**ìœ„ì¹˜**: `BoardService.getBoard()` (line 209-220), `BoardService.shouldIncrementView()` (line 588-612)

**í˜„ì¬ êµ¬í˜„**:
- `BoardViewLog`ë¥¼ í†µí•œ ì¤‘ë³µ ì¡°íšŒ ë°©ì§€
- `shouldIncrementView()` ë©”ì„œë“œë¡œ ì´ë¯¸ ì¡°íšŒí•œ ê²Œì‹œê¸€ì€ ì¡°íšŒìˆ˜ ì¦ê°€ ì•ˆ í•¨
- ë‹¨ì¼ íŠ¸ëœì­ì…˜ì—ì„œ ì¡°íšŒìˆ˜ ì¦ê°€

**ë¬¸ì œì **:
- ë™ì‹œì— ì—¬ëŸ¬ ì‚¬ìš©ìê°€ ì¡°íšŒ ì‹œ Race Condition ê°€ëŠ¥ì„±
- `BoardViewLog` í…Œì´ë¸” í¬ê¸° ì¦ê°€ (ìˆ˜ë§Œ~ìˆ˜ì‹­ë§Œ ê±´)

**ê°œì„  ë°©ì•ˆ**:
1. **Redis ë°©ì‹ìœ¼ë¡œ ì „í™˜** (ë¬¸ì„œì— ê°œì„ ì•ˆ ì œì‹œë¨)
   - `board:{boardId}:viewers` Setì— ì‚¬ìš©ì ID ì €ì¥
   - TTL 24ì‹œê°„ ì„¤ì •
   - DB ë¶€ë‹´ ê°ì†Œ, ë¹ ë¥¸ ì†ë„

2. **ë¹„ë™ê¸° ì²˜ë¦¬**: ì¡°íšŒìˆ˜ ì¦ê°€ë¥¼ `@Async`ë¡œ ì²˜ë¦¬

### âš ï¸ ê°œì„  í•„ìš”: í˜ì´ì§• ìµœì í™”

**í˜„ì¬ ìƒíƒœ**:
- Offset í˜ì´ì§• ì‚¬ìš© (`Pageable` í™œìš©)
- ê´€ë¦¬ì í˜ì´ì§€ì—ì„œ ë©”ëª¨ë¦¬ í˜ì´ì§• ì‚¬ìš© (`getAdminBoardsWithPaging()`)

**ë¬¸ì œì **:
- Offset í˜ì´ì§•ì€ í˜ì´ì§€ê°€ ë’¤ë¡œ ê°ˆìˆ˜ë¡ ì„±ëŠ¥ ì €í•˜
- ì˜ˆ: `LIMIT 20 OFFSET 10000` â†’ 10000ê°œ í–‰ì„ ìŠ¤ìº” í›„ ë²„ë¦¼

**ê°œì„  ë°©ì•ˆ** (ë¬¸ì„œì— ì œì‹œë¨):
1. **Cursor í˜ì´ì§• ì ìš©**
   - ë§ˆì§€ë§‰ ì¡°íšŒ IDë¥¼ ê¸°ì–µí•˜ì—¬ ë‹¤ìŒ í˜ì´ì§€ ì¡°íšŒ
   - ì¼ì •í•œ ì„±ëŠ¥ ìœ ì§€
   - ë‹¨ì : íŠ¹ì • í˜ì´ì§€ë¡œ ì´ë™ ë¶ˆê°€

2. **ê´€ë¦¬ì í˜ì´ì§€ DB ë ˆë²¨ í˜ì´ì§•**
   - í˜„ì¬ ë©”ëª¨ë¦¬ í˜ì´ì§• â†’ DB ë ˆë²¨ í˜ì´ì§•ìœ¼ë¡œ ë³€ê²½

### ğŸ“Š ì¸ë±ìŠ¤ ìµœì í™”

**í˜„ì¬ ì ìš©ëœ ì¸ë±ìŠ¤** (âœ… ëŒ€ë¶€ë¶„ ì ìš©ë¨):
```sql
-- ê²Œì‹œê¸€ ì¡°íšŒ ì„±ëŠ¥ í–¥ìƒ
CREATE INDEX idx_board_created_at ON board(created_at);
CREATE INDEX idx_board_category_created_at ON board(category, created_at);
CREATE INDEX idx_board_user_idx_created_at ON board(user_idx, created_at);
CREATE FULLTEXT INDEX idx_board_title_content ON board(title, content) WITH PARSER ngram;

-- ëŒ“ê¸€ ì¡°íšŒ ì„±ëŠ¥ í–¥ìƒ
CREATE INDEX idx_comment_board_deleted_created ON comment(board_idx, is_deleted, created_at ASC);
CREATE INDEX idx_comment_user ON comment(user_idx);

-- ë°˜ì‘ ì¡°íšŒ ì„±ëŠ¥ í–¥ìƒ
CREATE INDEX idx_board_reaction_board_type ON board_reaction(board_idx, reaction_type);
CREATE INDEX idx_board_reaction_user ON board_reaction(user_idx);
CREATE UNIQUE INDEX idx_board_reaction_unique ON board_reaction(board_idx, user_idx);

-- ì¡°íšŒìˆ˜ ë¡œê·¸
CREATE INDEX idx_board_view_log_board ON board_view_log(board_idx);
CREATE INDEX idx_board_view_log_user ON board_view_log(user_idx);
CREATE UNIQUE INDEX idx_board_view_log_unique ON board_view_log(board_idx, user_idx);
```

**ì¶”ê°€ ê¶Œì¥ ì¸ë±ìŠ¤**:
```sql
-- ë³µí•© ì¸ë±ìŠ¤ (ì¹´í…Œê³ ë¦¬ + ì‚­ì œ ì—¬ë¶€ + ìƒì„±ì¼)
CREATE INDEX idx_board_category_deleted_created ON board(category, is_deleted, created_at DESC);

-- ìƒíƒœë³„ ì¡°íšŒ
CREATE INDEX idx_board_status ON board(status);

-- ì‚¬ìš©ìë³„ + ì‚­ì œ ì—¬ë¶€
CREATE INDEX idx_board_user_deleted ON board(user_idx, is_deleted);
```

### ğŸ”„ ê²€ìƒ‰ ê¸°ëŠ¥ ê°œì„  í•„ìš”

**í˜„ì¬ ìƒíƒœ**:
- âœ… **ì¼ë°˜ ìœ ì € ê²€ìƒ‰**: Full-Text Search ì‚¬ìš© (MATCH ... AGAINST IN BOOLEAN MODE)
  - ìœ„ì¹˜: `BoardRepository.searchByKeywordWithPaging()` (line 66-80)
  - relevance ì ìˆ˜ ê¸°ë°˜ ì •ë ¬ ì ìš©
  - ì„±ëŠ¥ ìµœì í™”ë¨
  
- âŒ **ê´€ë¦¬ì ê²€ìƒ‰**: Full-Text Search ë¯¸ì‚¬ìš©
  - ìœ„ì¹˜: `BoardService.getAdminBoardsWithPaging()` (line 82-207)
  - ë©”ëª¨ë¦¬ í•„í„°ë§ ì‚¬ìš© (ë¹„íš¨ìœ¨ì )
  - ëŒ€ëŸ‰ ë°ì´í„°ì—ì„œ ì„±ëŠ¥ ì €í•˜ ê°€ëŠ¥

**ê°œì„  í•„ìš” ì‚¬í•­**:
1. **ê´€ë¦¬ì ê²€ìƒ‰ë„ Full-Text Search ì‚¬ìš©**
   - `getAdminBoardsWithPaging()` ë©”ì„œë“œ ê°œì„ 
   - ê´€ë¦¬ììš© Full-Text Search ì¿¼ë¦¬ ì¶”ê°€ (ì‘ì„±ì ìƒíƒœ ì²´í¬ ì—†ì´)
   - relevance ì ìˆ˜ ê¸°ë°˜ ì •ë ¬ ì ìš©

2. **ê²€ìƒ‰ ê²°ê³¼ ì •í™•ë„ í–¥ìƒ** (ì„ íƒì‚¬í•­)
   - ê²€ìƒ‰ì–´ ìë™ì™„ì„±/ì œì•ˆ ê¸°ëŠ¥
   - ê²€ìƒ‰ ê²°ê³¼ í•˜ì´ë¼ì´íŒ…
   - ê²€ìƒ‰ì–´ ìœ ì‚¬ë„ ê³„ì‚° (TF-IDF, BM25 ë“±)

3. **ê²€ìƒ‰ ì„±ëŠ¥ ìµœì í™”** (ì„ íƒì‚¬í•­)
   - ê²€ìƒ‰ ê²°ê³¼ ìºì‹± (Redis)
   - ì¸ê¸° ê²€ìƒ‰ì–´ í†µê³„
   - ê²€ìƒ‰ ë¡œê·¸ ë¶„ì„

### ğŸ“ˆ ì„±ëŠ¥ ìµœì í™” ìš”ì•½

**ì ìš© ì™„ë£Œ**:
- âœ… N+1 ë¬¸ì œ í•´ê²° (ë°°ì¹˜ ì¡°íšŒ)
- âœ… Fetch Join ì ìš©
- âœ… ì¸ê¸°ê¸€ ìŠ¤ëƒ…ìƒ· ìƒì„±
- âœ… FULLTEXT ì¸ë±ìŠ¤ í™œìš©
- âœ… ê¸°ë³¸ ì¸ë±ì‹± ì „ëµ

**ê°œì„  í•„ìš”**:
- âš ï¸ ìºì‹± ì „ëµ (Redis ì „í™˜, ëª©ë¡ ìºì‹œ ì¬í™œì„±í™”)
- âš ï¸ í˜ì´ì§• ìµœì í™” (Cursor í˜ì´ì§•)
- âš ï¸ ì¡°íšŒìˆ˜ ìµœì í™” (Redis ë°©ì‹)
- âš ï¸ ê´€ë¦¬ì ê²€ìƒ‰ (Full-Text Search ì ìš©)

---

<!-- =================================================================================================================================== -->
<!-- =================================================================================================================================== -->
<!-- =================================================================================================================================== -->

## 5. ğŸ¥ Care (ëŒë´„ ìš”ì²­) ë„ë©”ì¸

### âš ï¸ ì ì¬ì  ë¬¸ì œ: ìƒíƒœ ë³€ê²½ Race Condition

**ìœ„ì¹˜**: `CareRequestService.updateStatus()` (line 153-161)

**ë¬¸ì œ**: ìƒíƒœ ë³€ê²½ ì‹œ ë™ì‹œì„± ì œì–´ ì—†ìŒ
- **ê°œì„ **: Optimistic Lock ë˜ëŠ” ìƒíƒœ ë¨¸ì‹  íŒ¨í„´ ì ìš©

### ğŸ“Š ì¸ë±ìŠ¤ ìµœì í™”

**í•„ìš”í•œ ì¸ë±ìŠ¤**:
```sql
-- ëŒë´„ ìš”ì²­ ì¡°íšŒ ì„±ëŠ¥ í–¥ìƒ
CREATE INDEX idx_care_request_status_deleted ON care_request(status, is_deleted);
CREATE INDEX idx_care_request_user_deleted ON care_request(user_idx, is_deleted);
CREATE INDEX idx_care_request_date ON care_request(date);
CREATE INDEX idx_care_request_location ON care_request(location); -- ìœ„ì¹˜ ê¸°ë°˜ ê²€ìƒ‰

-- ì§€ì›ì„œ ì¡°íšŒ ì„±ëŠ¥ í–¥ìƒ
CREATE INDEX idx_care_application_request ON care_application(care_request_idx);
CREATE INDEX idx_care_application_user ON care_application(user_idx);
CREATE INDEX idx_care_application_status ON care_application(status);
```

### ğŸ”„ íŠ¸ëœì­ì…˜ ê°œì„ 

**í˜„ì¬**: ìœ„ì¹˜ í•„í„°ë§ì„ Javaì—ì„œ ì²˜ë¦¬ (line 46-51)
- **ê°œì„ **: DB ë ˆë²¨ì—ì„œ ìœ„ì¹˜ ê¸°ë°˜ ì¿¼ë¦¬ ìµœì í™”

---

<!-- =================================================================================================================================== -->
<!-- =================================================================================================================================== -->
<!-- =================================================================================================================================== -->

## 6. ğŸ“¢ Report (ì‹ ê³ ) ë„ë©”ì¸

### âœ… ì¤‘ë³µ ì‹ ê³  ì²´í¬ëŠ” ì •ìƒ ë™ì‘
- **í˜„ì¬**: ê°™ì€ ì‚¬ìš©ìê°€ ê°™ì€ ëŒ€ìƒì„ ì¤‘ë³µ ì‹ ê³ í•˜ëŠ” ê²ƒì€ ë°©ì§€ë¨ (DB Unique Constraint)
- **ì„¤ëª…**: ì—¬ëŸ¬ ìœ ì €ê°€ ê°™ì€ ì½˜í…ì¸ ë¥¼ ì‹ ê³ í•˜ëŠ” ê²ƒì€ ì •ìƒì ì¸ ë™ì‘ì´ë©°, ì´ëŠ” ë¬¸ì œê°€ ì•„ë‹˜

### âœ… ê°œì„  ì™„ë£Œ: ì‹ ê³  íšŸìˆ˜ ì§‘ê³„ ë° ìš°ì„ ìˆœìœ„ ì •ë ¬

**êµ¬í˜„ ì™„ë£Œ**:
- âœ… **ReportDTOì— reportCount í•„ë“œ ì¶”ê°€**: ê° ì‹ ê³  í•­ëª©ì— í•´ë‹¹ targetì˜ ì´ ì‹ ê³  íšŸìˆ˜ í‘œì‹œ
- âœ… **ì‹ ê³  íšŸìˆ˜ ì§‘ê³„**: ê°™ì€ target_type + target_idxì— ëŒ€í•œ ì‹ ê³  ê°œìˆ˜ ê³„ì‚°
- âœ… **ìš°ì„ ìˆœìœ„ ì •ë ¬**: ì‹ ê³  íšŸìˆ˜ê°€ ë§ì€ ìˆœì„œëŒ€ë¡œ ì •ë ¬ (ì‹ ê³  íšŸìˆ˜ DESC, ìƒì„±ì¼ì‹œ DESC)
- âœ… **ReportService.getReports() ê°œì„ **: ì‹ ê³  íšŸìˆ˜ ì§‘ê³„ ë° ì •ë ¬ ë¡œì§ ì¶”ê°€

**êµ¬í˜„ ìœ„ì¹˜**:
- `ReportDTO.reportCount` (line 30)
- `ReportRepository.findReportsWithFilters()` (line 24-29)
- `ReportService.getReports()` (line 87-142)

### ğŸ“Š ì¸ë±ìŠ¤ ìµœì í™”

**í•„ìš”í•œ ì¸ë±ìŠ¤**:
```sql
-- ì‹ ê³  ì¡°íšŒ ì„±ëŠ¥ í–¥ìƒ
CREATE INDEX idx_report_target_type_status ON report(target_type, status, created_at DESC);
CREATE INDEX idx_report_reporter ON report(reporter_idx);
CREATE INDEX idx_report_target ON report(target_type, target_idx);
CREATE INDEX idx_report_status ON report(status);
CREATE UNIQUE INDEX idx_report_unique ON report(target_type, target_idx, reporter_idx);
```

---

<!-- =================================================================================================================================== -->
<!-- =================================================================================================================================== -->
<!-- =================================================================================================================================== -->

## 7. ğŸ”” Notification (ì•Œë¦¼) ë„ë©”ì¸

### âœ… ì´ë¯¸ ê°œì„ ë¨: Redis ìºì‹±ìœ¼ë¡œ ì„±ëŠ¥ ìµœì í™”

**ìœ„ì¹˜**: `NotificationService` ì „ì²´

### ğŸ“Š ì¸ë±ìŠ¤ ìµœì í™”

**í•„ìš”í•œ ì¸ë±ìŠ¤**:
```sql
-- ì•Œë¦¼ ì¡°íšŒ ì„±ëŠ¥ í–¥ìƒ
CREATE INDEX idx_notification_user_created ON notification(user_idx, created_at DESC);
CREATE INDEX idx_notification_user_read ON notification(user_idx, is_read, created_at DESC);
CREATE INDEX idx_notification_type ON notification(type);
```

---

## 8. ğŸ“ Location (ìœ„ì¹˜ ì„œë¹„ìŠ¤) ë„ë©”ì¸

### ğŸ“Š ì¸ë±ìŠ¤ ìµœì í™”

**í•„ìš”í•œ ì¸ë±ìŠ¤**:
```sql
-- ìœ„ì¹˜ ì„œë¹„ìŠ¤ ì¡°íšŒ ì„±ëŠ¥ í–¥ìƒ
CREATE INDEX idx_location_service_category_rating ON locationservice(category, rating DESC);
CREATE INDEX idx_location_service_location ON locationservice(latitude, longitude);
CREATE INDEX idx_location_service_sido ON locationservice(sido);
CREATE INDEX idx_location_service_sigungu ON locationservice(sigungu);
CREATE INDEX idx_location_service_eupmyeondong ON locationservice(eupmyeondong);
CREATE INDEX idx_location_service_road_name ON locationservice(road_name);

-- ë¦¬ë·° ì¡°íšŒ ì„±ëŠ¥ í–¥ìƒ
CREATE INDEX idx_location_review_service ON location_service_review(location_service_idx);
CREATE INDEX idx_location_review_user ON location_service_review(user_idx);
CREATE INDEX idx_location_review_rating ON location_service_review(rating);
```

### ğŸ”„ ìë£Œêµ¬ì¡°/ì•Œê³ ë¦¬ì¦˜ ì ìš©

**í˜„ì¬**: `getNearbyMeetups()`ì—ì„œ Haversine ê³µì‹ ì‚¬ìš© (line 162-179)
- **ê°œì„ **: ê³µê°„ ì¸ë±ìŠ¤ (Spatial Index) ì‚¬ìš© ê³ ë ¤
```sql
-- MySQL 8.0+ Spatial Index
ALTER TABLE locationservice 
ADD SPATIAL INDEX idx_location_service_coords (POINT(longitude, latitude));
```

---

## ğŸ¯ ìš°ì„ ìˆœìœ„ë³„ ê°œì„  ì²´í¬ë¦¬ìŠ¤íŠ¸

### ğŸ”´ Critical (ì¦‰ì‹œ ìˆ˜ì • í•„ìš”)

1. **Meetup**: `currentParticipants` ì¦ê°€/ê°ì†Œ Race Condition
   - Pessimistic Lock ë˜ëŠ” Optimistic Lock ì ìš©
   - DB ì œì•½ì¡°ê±´ ì¶”ê°€

2. **Report**: ì¤‘ë³µ ì‹ ê³  ì²´í¬ Race Condition
   - Unique ì œì•½ì¡°ê±´ ì¶”ê°€
   - ì˜ˆì™¸ ì²˜ë¦¬ ê°œì„ 

3. **User**: ë‹‰ë„¤ì„ ì¤‘ë³µ ì²´í¬ ì˜ˆì™¸ ì²˜ë¦¬
   - `DataIntegrityViolationException` ì²˜ë¦¬ ì¶”ê°€

### ğŸŸ¡ High (ë¹ ë¥¸ ì‹œì¼ ë‚´ ìˆ˜ì •)

4. **Chat**: ì¸ë±ìŠ¤ ì¶”ê°€
   - ë©”ì‹œì§€ ì¡°íšŒ ì„±ëŠ¥ í–¥ìƒ

5. **Board**: ì¸ë±ìŠ¤ ì¶”ê°€
   - ê²€ìƒ‰ ì„±ëŠ¥ í–¥ìƒ

6. **Care**: ìƒíƒœ ë³€ê²½ ë™ì‹œì„± ì œì–´
   - Optimistic Lock ì ìš©

### ğŸŸ¢ Medium (ì ì§„ì  ê°œì„ )

7. **Location**: ê³µê°„ ì¸ë±ìŠ¤ ì ìš©
   - ìœ„ì¹˜ ê¸°ë°˜ ê²€ìƒ‰ ì„±ëŠ¥ í–¥ìƒ

8. **Meetup**: ê±°ë¦¬ ê³„ì‚° DB ë ˆë²¨ ì²˜ë¦¬
   - Java í•„í„°ë§ â†’ DB ì¿¼ë¦¬ë¡œ ë³€ê²½

9. **Board**: ì¡°íšŒìˆ˜ ì¦ê°€ ë¹„ë™ê¸° ì²˜ë¦¬
   - ì„±ëŠ¥ ìµœì í™”

---

## ğŸ“š ì°¸ê³  ìë£Œ

- [Spring Data JPA Locking](https://www.baeldung.com/jpa-pessimistic-locking)
- [MySQL Index Optimization](https://dev.mysql.com/doc/refman/8.0/en/optimization-indexes.html)
- [Race Condition Prevention](https://www.baeldung.com/java-race-conditions)
- [Transaction Isolation Levels](https://www.baeldung.com/spring-transactional-propagation-isolation)
