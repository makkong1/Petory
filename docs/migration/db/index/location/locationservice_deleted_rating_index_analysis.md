# idx_locationservice_deleted_rating ì¸ë±ìŠ¤ ì‚­ì œ ì—¬ë¶€ ë¶„ì„

## ğŸ“Š í˜„ì¬ ìƒí™©

### ì¸ë±ìŠ¤ ì •ë³´
- **ì¸ë±ìŠ¤ëª…**: `idx_locationservice_deleted_rating`
- **êµ¬ì¡°**: `(is_deleted, rating DESC)`
- **ìš©ë„**: ì „ì²´ ì¡°íšŒ ì‹œ í‰ì ìˆœ ì •ë ¬ (`findByOrderByRatingDesc`)

### ì‹¤ì œ ì‚¬ìš©ì²˜
- `LocationServiceService.java` (78ì¤„): ì „ì²´ ì¡°íšŒ ì‹œ ì‚¬ìš©
- `findByOrderByRatingDesc()`: ëª¨ë“  íŒŒë¼ë¯¸í„°ê°€ ì—†ì„ ë•Œ ì „ì²´ ì¡°íšŒ

## âš ï¸ ë¬¸ì œì 

### 1. ì˜ëª»ëœ ì¸ë±ìŠ¤ ì„ íƒ
**ë¬¸ì œ ì¿¼ë¦¬ íŒ¨í„´:**
```sql
WHERE sido = 'ì„œìš¸íŠ¹ë³„ì‹œ' 
  AND is_deleted = 0 
  AND rating <= 2.0
ORDER BY rating DESC
```

**ì‹¤ì œ EXPLAIN ê²°ê³¼:**
- key: `idx_locationservice_deleted_rating` âŒ (ì˜ëª»ëœ ì¸ë±ìŠ¤)
- rows: 11109 (ì „ì²´ì˜ ì•½ 50%)
- filtered: 10.00% (ë‚®ìŒ)
- **ë¬¸ì œ**: sido ì¡°ê±´ì´ ì¸ë±ìŠ¤ì— ì—†ì–´ì„œ ë§ì€ í–‰ ìŠ¤ìº”

**ì˜¬ë°”ë¥¸ ì¸ë±ìŠ¤:**
- `idx_locationservice_sido_deleted_rating` âœ…
- rows: 7422 (ì•½ 33% ê°ì†Œ)
- filtered: 100.00% (ì™„ë²½)

### 2. ë™ì¼í•œ ë¬¸ì œê°€ ë°œìƒí•˜ëŠ” ì¿¼ë¦¬
- `WHERE sigungu = ? AND is_deleted = 0 AND rating >= 4.5`
- `WHERE sido = ? AND is_deleted = 0 AND rating <= 2.0`

## ğŸ’¡ í•´ê²° ë°©ì•ˆ

### ë°©ì•ˆ 1: ì¸ë±ìŠ¤ ìœ ì§€ + ì¸ë±ìŠ¤ íŒíŠ¸ ì‚¬ìš© (ê¶Œì¥) â­â­â­â­

**ì¥ì :**
- ì „ì²´ ì¡°íšŒ ì¿¼ë¦¬(`findByOrderByRatingDesc`) ì„±ëŠ¥ ìœ ì§€
- rating ë²”ìœ„ ì¡°ê±´ì´ ìˆëŠ” ì¿¼ë¦¬ì— ì¸ë±ìŠ¤ íŒíŠ¸ ì‚¬ìš©

**ë‹¨ì :**
- Repository ì¿¼ë¦¬ì— ì¸ë±ìŠ¤ íŒíŠ¸ ì¶”ê°€ í•„ìš”
- ì¸ë±ìŠ¤ ì¤‘ë³µ (ì €ì¥ ê³µê°„ ì‚¬ìš©)

**êµ¬í˜„:**
```java
// Repository ì¿¼ë¦¬ì— ì¸ë±ìŠ¤ íŒíŠ¸ ì¶”ê°€
@Query(value = "SELECT * FROM locationservice USE INDEX (idx_locationservice_sido_deleted_rating) " +
        "WHERE sido = :sido AND is_deleted = 0 AND rating <= :maxRating " +
        "ORDER BY rating DESC", nativeQuery = true)
```

### ë°©ì•ˆ 2: ì¸ë±ìŠ¤ ì‚­ì œ (ì „ì²´ ì¡°íšŒ ìµœì í™” í•„ìš”) â­â­â­

**ì „ì œ ì¡°ê±´:**
- `findByOrderByRatingDesc()` ì‚¬ìš© ë¹ˆë„ê°€ ë‚®ê±°ë‚˜
- í˜ì´ì§• ì²˜ë¦¬ë¡œ ë³€ê²½ ê°€ëŠ¥

**ì¥ì :**
- ì¸ë±ìŠ¤ ì¤‘ë³µ ì œê±°
- MySQL ì˜µí‹°ë§ˆì´ì €ê°€ ì˜¬ë°”ë¥¸ ì¸ë±ìŠ¤ ì„ íƒ

**ë‹¨ì :**
- ì „ì²´ ì¡°íšŒ ì¿¼ë¦¬ ì„±ëŠ¥ ì €í•˜ ê°€ëŠ¥
- `findByOrderByRatingDesc()` ìµœì í™” í•„ìš”

**êµ¬í˜„:**
```sql
-- ì¸ë±ìŠ¤ ì‚­ì œ
DROP INDEX idx_locationservice_deleted_rating ON locationservice;

-- ì „ì²´ ì¡°íšŒ ì¿¼ë¦¬ ìµœì í™” (í˜ì´ì§• ì¶”ê°€)
@Query(value = "SELECT * FROM locationservice WHERE is_deleted = 0 " +
        "ORDER BY rating DESC LIMIT :limit OFFSET :offset", nativeQuery = true)
```

### ë°©ì•ˆ 3: ì¸ë±ìŠ¤ ìœ ì§€ + í†µê³„ ì—…ë°ì´íŠ¸ (ì„ íƒì ) â­â­

**êµ¬í˜„:**
```sql
-- ì¸ë±ìŠ¤ í†µê³„ ì—…ë°ì´íŠ¸ (MySQLì´ ë” ë‚˜ì€ ì¸ë±ìŠ¤ ì„ íƒí•˜ë„ë¡)
ANALYZE TABLE locationservice;

-- ë˜ëŠ” ì¸ë±ìŠ¤ íŒíŠ¸ ì—†ì´ë„ ì˜¬ë°”ë¥¸ ì¸ë±ìŠ¤ ì„ íƒí•˜ë„ë¡ í†µê³„ ì—…ë°ì´íŠ¸
```

**ë‹¨ì :**
- í†µê³„ ì—…ë°ì´íŠ¸ë§Œìœ¼ë¡œëŠ” í•´ê²°ë˜ì§€ ì•Šì„ ìˆ˜ ìˆìŒ
- rating ë²”ìœ„ ì¡°ê±´ì´ ìˆì„ ë•Œ ì—¬ì „íˆ ì˜ëª»ëœ ì¸ë±ìŠ¤ ì„ íƒ ê°€ëŠ¥

## ğŸ¯ ê¶Œì¥ì‚¬í•­

### ì¦‰ì‹œ ì ìš© (ë‹¨ê¸°)
1. âœ… **ì¸ë±ìŠ¤ ìœ ì§€** (ì „ì²´ ì¡°íšŒ ì¿¼ë¦¬ ì„±ëŠ¥ ìœ ì§€)
2. âœ… **rating ë²”ìœ„ ì¡°ê±´ì´ ìˆëŠ” ì¿¼ë¦¬ì— ì¸ë±ìŠ¤ íŒíŠ¸ ì¶”ê°€**
   - `findBySido` + rating ë²”ìœ„ ì¡°ê±´
   - `findBySigungu` + rating ë²”ìœ„ ì¡°ê±´
   - `findByEupmyeondong` + rating ë²”ìœ„ ì¡°ê±´

### ì¥ê¸° ê²€í† 
1. âœ… **ì „ì²´ ì¡°íšŒ ì¿¼ë¦¬ ì‚¬ìš© ë¹ˆë„ í™•ì¸**
   - ì‚¬ìš© ë¹ˆë„ê°€ ë‚®ìœ¼ë©´ ì¸ë±ìŠ¤ ì‚­ì œ ê³ ë ¤
   - ì‚¬ìš© ë¹ˆë„ê°€ ë†’ìœ¼ë©´ ì¸ë±ìŠ¤ ìœ ì§€

2. âœ… **ì „ì²´ ì¡°íšŒ ì¿¼ë¦¬ í˜ì´ì§• ì²˜ë¦¬**
   - ëŒ€ëŸ‰ ë°ì´í„° ì¡°íšŒ ë°©ì§€
   - ì„±ëŠ¥ ê°œì„ 

3. âœ… **ì¸ë±ìŠ¤ í†µê³„ ëª¨ë‹ˆí„°ë§**
   - ì£¼ê¸°ì ìœ¼ë¡œ `ANALYZE TABLE` ì‹¤í–‰
   - ì¸ë±ìŠ¤ ì„ íƒ ìµœì í™”

## ğŸ“ ê²°ë¡ 

### í˜„ì¬ ìƒí™©
- **ì¸ë±ìŠ¤ ìœ ì§€ ê¶Œì¥** â­â­â­â­
- ì „ì²´ ì¡°íšŒ ì¿¼ë¦¬(`findByOrderByRatingDesc`)ê°€ ì‹¤ì œë¡œ ì‚¬ìš© ì¤‘
- ì¸ë±ìŠ¤ ì‚­ì œ ì‹œ ì „ì²´ ì¡°íšŒ ì„±ëŠ¥ ì €í•˜ ê°€ëŠ¥

### ê°œì„  ë°©ë²•
1. **rating ë²”ìœ„ ì¡°ê±´ì´ ìˆëŠ” ì¿¼ë¦¬ì— ì¸ë±ìŠ¤ íŒíŠ¸ ì¶”ê°€**
2. **ì „ì²´ ì¡°íšŒ ì¿¼ë¦¬ í˜ì´ì§• ì²˜ë¦¬ ê²€í† **
3. **ì¸ë±ìŠ¤ ì‚¬ìš© ëª¨ë‹ˆí„°ë§ ë° í†µê³„ ì—…ë°ì´íŠ¸**

### ì‚­ì œ ê³ ë ¤ ì‹œì 
- ì „ì²´ ì¡°íšŒ ì¿¼ë¦¬ ì‚¬ìš© ë¹ˆë„ê°€ ë§¤ìš° ë‚®ì„ ë•Œ
- ì „ì²´ ì¡°íšŒ ì¿¼ë¦¬ë¥¼ í˜ì´ì§• ì²˜ë¦¬ë¡œ ë³€ê²½í•œ í›„
- ë‹¤ë¥¸ ì¸ë±ìŠ¤ë¡œ ì»¤ë²„ ê°€ëŠ¥í•  ë•Œ
