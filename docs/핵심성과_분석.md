# 핵심 성과 분석 - 프로젝트 전반 공통 문제 해결

## 📊 분석 기준
- ✅ 여러 도메인에서 반복적으로 발생하고 해결한 문제
- ✅ 프로젝트 전반을 대표할 수 있는 문제
- ✅ 정량적 개선 효과가 명확한 문제

---

## 🎯 핵심 성과 후보

### 1️⃣ N+1 문제 해결 (배치 조회 패턴) ⭐⭐⭐ **최우선 추천**

**발생 도메인:**
- ✅ **Chat 도메인**: 로그인 시 채팅방 목록 조회
- ✅ **Board 도메인**: 게시글 목록 조회 시 반응 정보

**문제 상황:**
- Chat: 채팅방 N개 조회 시 21개 쿼리 발생 (이론상 31개)
- Board: 게시글 1000개 조회 시 2001개 쿼리 발생

**해결 방법:**64
- **배치 조회 패턴**: `IN` 절을 사용한 일괄 조회
- **Fetch Join**: 연관 엔티티 함께 조회
- **Map 기반 매핑**: 메모리에서 빠른 데이터 매핑

**개선 효과:**
- **Chat**: 21개 → 4개 쿼리 (**80.95% 개선**)
  - 실행 시간: 305ms → 55ms (**81.97% 단축**)
  - 메모리: 0.58MB → 0.13MB (**77.24% 감소**)
- **Board**: 2001개 → 3개 쿼리 (**99% 이상 개선**)
  - 조회 시간: ~30초 → ~0.3초

**적용 패턴:**
```java
// 1. ID 목록 추출
List<Long> ids = entities.stream().map(Entity::getId).collect(Collectors.toList());

// 2. 배치 조회 (IN 절)
@Query("SELECT e FROM Entity e WHERE e.id IN :ids")
List<Entity> findByIds(@Param("ids") List<Long> ids);

// 3. Map으로 변환하여 메모리에서 매핑
Map<Long, Entity> entityMap = entities.stream()
    .collect(Collectors.toMap(Entity::getId, e -> e));
```

**이력서/포트폴리오 표현:**
> **N+1 문제를 배치 조회 패턴으로 해결하여 쿼리 수 대폭 감소**
> - Chat 도메인: 21개 → 4개 쿼리 (80.95% 개선, 실행 시간 81.97% 단축)
> - Board 도메인: 2001개 → 3개 쿼리 (99% 이상 개선, 조회 시간 30초 → 0.3초)
> - **공통 해결 패턴**: IN 절 배치 조회 + Fetch Join + Map 기반 매핑
> - **확장성**: 데이터 증가에도 쿼리 수 일정하게 유지

---

### 2️⃣ Race Condition 해결 (동시성 제어) ⭐⭐

**발생 도메인:**
- ✅ **Meetup 도메인**: 모임 참가 시 인원 초과 문제 (Pessimistic Lock)
- ✅ **User 도메인**: 닉네임 중복 체크, 경고 횟수 증가 (DB Unique 제약조건, 원자적 증가)
- ✅ **Chat 도메인**: 읽지 않은 메시지 수 증가 (원자적 증가 쿼리)
- ✅ **Report 도메인**: 중복 신고 체크 (DB Unique 제약조건)
- ✅ **Board 도메인**: 좋아요/싫어요 중복 처리, 댓글 수 증가 (DB Unique 제약조건, 원자적 증가)
- ✅ **Care 도메인**: 거래 확정 동시성 제어 (트랜잭션)

**문제 상황:**
- Meetup: 동시 참가 시 최대 인원 초과 (3명 제한인데 4명 참가)
- User: 동시 가입 시 같은 닉네임 허용, 경고 횟수 증가 시 Lost Update
- Chat: 메시지 전송 시 읽지 않은 메시지 수 증가 시 Lost Update
- Report: 동시 신고 시 중복 신고 허용
- Board: 동시 클릭 시 좋아요 중복 생성, 댓글 수 증가 시 Lost Update
- Care: 거래 확정 시 동시성 문제

**해결 방법:**
1. **Pessimistic Lock**: Meetup 도메인 (동시 접근 방지)
2. **DB Unique 제약조건**: User, Report, Board 도메인 (DB 레벨 보장)
3. **원자적 업데이트 쿼리**: Chat, User, Board 도메인 (`@Modifying @Query`로 DB 레벨 증가)
4. **트랜잭션**: Care 도메인 (거래 확정 동시성 제어)

**개선 효과:**
- **Meetup**: 인원 초과 방지 (4명 → 3명, 100% 데이터 정합성 보장)
- **User**: 중복 데이터 완전 방지, 경고 횟수 정확한 증가
- **Chat**: 읽지 않은 메시지 수 정확한 증가 (Lost Update 방지)
- **Board**: 중복 데이터 완전 방지, 댓글 수 정확한 증가
- **Care**: 거래 확정 시 데이터 정합성 보장

**적용 패턴:**
```java
// 1. Pessimistic Lock (Meetup)
@Lock(LockModeType.PESSIMISTIC_WRITE)
@Query("SELECT m FROM Meetup m WHERE m.idx = :idx")
Optional<Meetup> findByIdWithLock(@Param("idx") Long idx);

// 2. DB Unique 제약조건 (User, Report, Board)
@Column(unique = true)
private String nickname;

// 3. 원자적 증가 쿼리 (Chat, User, Board)
@Modifying
@Query("UPDATE ConversationParticipant cp SET cp.unreadCount = cp.unreadCount + 1 " +
       "WHERE cp.conversation.idx = :conversationIdx AND cp.user.idx != :senderUserId")
void incrementUnreadCount(@Param("conversationIdx") Long conversationIdx, 
                          @Param("senderUserId") Long senderUserId);

@Modifying
@Query("UPDATE Users u SET u.warningCount = u.warningCount + 1 WHERE u.idx = :userId")
void incrementWarningCount(@Param("userId") Long userId);
```

**이력서/포트폴리오 표현:**
> **Race Condition을 동시성 제어 기법으로 해결하여 데이터 정합성 보장**
> - Meetup: Pessimistic Lock으로 인원 초과 방지 (잘못된 참가 4명 → 정확한 참가 3명)
> - User/Chat/Board: 원자적 증가 쿼리로 Lost Update 방지 (경고 횟수, 읽지 않은 메시지 수, 댓글 수)
> - User/Report/Board: DB Unique 제약조건으로 중복 데이터 완전 방지
> - **공통 해결 패턴**: Lock 메커니즘, 원자적 쿼리, DB 제약조건 활용
> - **안정성**: 동시 접근 시에도 데이터 무결성 100% 보장

---

### 3️⃣ 성능 최적화 (인덱스 전략) ⭐

**발생 도메인:**
- ✅ **전체 도메인**: 조회 성능 개선

**문제 상황:**
- 복합 조건 조회 시 테이블 스캔 발생
- 정렬 시 FileSort 발생
- 페이징 시 성능 저하

**해결 방법:**
- **복합 인덱스**: 카테고리 + 삭제 여부 + 생성일 정렬
- **커버링 인덱스**: 필요한 컬럼만 인덱스에 포함
- **Full-Text 인덱스**: 검색 성능 향상

**적용 예시:**
```sql
-- 복합 인덱스
CREATE INDEX idx_board_category_deleted_created 
ON board(category, is_deleted, created_at DESC);

-- 커버링 인덱스
CREATE INDEX idx_board_list_covering 
ON board(category, is_deleted, created_at DESC, idx, title, user_idx);

-- Full-Text 인덱스
CREATE FULLTEXT INDEX idx_board_fulltext 
ON board(title, content);
```

**이력서/포트폴리오 표현:**
> **복합 인덱스 전략으로 조회 성능 개선**
> - 카테고리별 조회: 테이블 스캔 → 인덱스 스캔 (FileSort 제거)
> - 커버링 인덱스: 테이블 접근 없이 인덱스만으로 쿼리 완성
> - Full-Text 인덱스: 검색 성능 향상

---

## 📈 최종 추천 순위

### 🥇 1순위: N+1 문제 해결 (배치 조회 패턴)
**이유:**
- ✅ **2개 이상 도메인에서 해결** (Chat, Board)
- ✅ **정량적 개선 효과 명확** (80% 이상 개선)
- ✅ **확장 가능한 패턴** (다른 도메인에도 적용 가능)
- ✅ **프로젝트 전반을 대표** (JPA 사용 시 흔한 문제)

**이력서 한 줄 요약:**
> N+1 문제를 배치 조회 패턴으로 해결하여 쿼리 수 2001개 → 3개로 감소 (99% 이상 개선)

**포트폴리오 상세:**
> **문제**: 게시글 목록 조회 시 각 게시글마다 반응 정보를 개별 조회하여 2001개 쿼리 발생
> **해결**: IN 절을 사용한 배치 조회 + Fetch Join으로 3개 쿼리로 감소
> **효과**: 조회 시간 30초 → 0.3초, 동일 패턴을 Chat 도메인에도 적용하여 21개 → 4개 쿼리로 개선

---

### 🥈 2순위: Race Condition 해결 (동시성 제어)
**이유:**
- ✅ **6개 이상 도메인에서 해결** (Meetup, User, Chat, Report, Board, Care)
- ✅ **데이터 정합성 보장** (비즈니스 로직 핵심)
- ✅ **다양한 해결 패턴 적용** (Lock, 원자적 쿼리, DB 제약조건)
- ⚠️ **정량적 효과는 상대적으로 낮음** (버그 수정 성격)

**이력서 한 줄 요약:**
> Race Condition을 Pessimistic Lock, 원자적 쿼리, DB 제약조건으로 해결하여 동시 접근 시 데이터 정합성 100% 보장

**포트폴리오 상세:**
> **문제**: 동시 참가 시 최대 인원 초과, 중복 닉네임/신고 허용, Lost Update 발생 등 데이터 불일치 발생
> **해결**: 
> - Pessimistic Lock (Meetup): 인원 초과 방지
> - 원자적 증가 쿼리 (Chat/User/Board): Lost Update 방지
> - DB Unique 제약조건 (User/Report/Board): 중복 데이터 방지
> **효과**: 인원 초과 방지, 중복 데이터 완전 차단, 카운트 정확성 보장, 동시 접근 시에도 안정적 동작

---

### 🥉 3순위: 성능 최적화 (인덱스 전략)
**이유:**
- ✅ **전체 도메인에 적용**
- ⚠️ **단독 성과로는 부족** (N+1, Race Condition과 함께 언급 가능)

**이력서 한 줄 요약:**
> 복합 인덱스 및 커버링 인덱스 전략으로 조회 성능 개선 (FileSort 제거, 테이블 스캔 방지)

---

## 💡 추가 제안

### 조합 표현 (더 강력한 성과)
**이력서 표현:**
> **JPA 성능 최적화 및 동시성 제어**
> - N+1 문제 해결: 배치 조회 패턴으로 쿼리 수 2001개 → 3개 (99% 개선)
> - Race Condition 해결: Pessimistic Lock, 원자적 쿼리, DB 제약조건으로 데이터 정합성 보장 (6개 도메인)
> - 인덱스 최적화: 복합 인덱스로 조회 성능 향상

**포트폴리오 표현:**
> **프로젝트 전반 성능 및 안정성 개선**
> 
> **1. N+1 문제 해결 (배치 조회 패턴)**
> - 문제: 게시글 목록 조회 시 각 게시글마다 반응 정보 개별 조회 (2001개 쿼리)
> - 해결: IN 절 배치 조회 + Fetch Join + Map 기반 매핑
> - 효과: 2001개 → 3개 쿼리 (99% 개선), 동일 패턴을 Chat 도메인에도 적용
> 
> **2. Race Condition 해결 (동시성 제어)**
> - 문제: 동시 참가 시 인원 초과, Lost Update 발생, 중복 데이터 생성
> - 해결: 
>   - Pessimistic Lock (Meetup): 인원 초과 방지
>   - 원자적 증가 쿼리 (Chat/User/Board): 읽지 않은 메시지 수, 경고 횟수, 댓글 수 정확한 증가
>   - DB Unique 제약조건 (User/Report/Board): 중복 데이터 방지
> - 효과: 데이터 정합성 100% 보장, 동시 접근 시 안정적 동작, 6개 도메인에 적용
> 
> **3. 인덱스 최적화**
> - 복합 인덱스로 FileSort 제거, 커버링 인덱스로 테이블 접근 최소화

---

## ✅ 체크리스트

- [x] 여러 도메인에서 반복적으로 발생한 문제
- [x] 프로젝트 전반을 대표할 수 있는 문제
- [x] 정량적 개선 효과 명확
- [x] 해결 방법이 재사용 가능한 패턴
- [x] 이력서/포트폴리오에 적합한 표현
