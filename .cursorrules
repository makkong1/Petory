# 개발 역량 및 기술 스택 규칙

## 필수 기술 역량

### 데이터베이스
- **인덱스**: 인덱스 설계 및 최적화 능력 필수
- **트랜잭션**: 트랜잭션 관리 및 동시성 제어 능력 필수
- **락**: 비관적 락, 낙관적 락 등 동시성 제어 기법 이해 및 적용

### 프로그래밍
- **프레임워크**: Spring Boot 등 주요 프레임워크 중급 이상 사용 능력
- **언어**: Java, JavaScript 등 사용 언어에 대한 중급 이상 수준의 이해

### 인프라 및 도구
- **네트워크**: HTTP/HTTPS, REST API, 웹소켓 등 네트워크 프로토콜 이해
- **컨테이너**: Docker, Kubernetes 등 컨테이너 기술 활용 능력
- **Git**: Git을 활용한 버전 관리 및 협업 능력

### 설계 및 아키텍처
- **아키텍처 패턴**: 마이크로서비스, 레이어드 아키텍처 등 주요 아키텍처 패턴 이해
- **디자인 패턴**: GoF 디자인 패턴 및 도메인별 패턴 적용 능력

### 프로젝트 경험
- **사이드 프로젝트**: 실제 사이드 프로젝트 개발 및 운영 경험
- **실운영 경험**: 실제 서비스 운영 경험이 있으면 더욱 우대

## 코드 작성 시 고려사항

1. **성능 최적화**: 인덱스 활용, 쿼리 최적화, N+1 문제 해결
2. **동시성 제어**: 트랜잭션 격리 수준, 락 전략 고려
3. **아키텍처 일관성**: 프로젝트의 아키텍처 패턴 준수
4. **디자인 패턴 적용**: 적절한 디자인 패턴 활용으로 코드 품질 향상
5. **실운영 고려**: 실제 운영 환경을 고려한 에러 처리, 로깅, 모니터링

## 리팩토링 규칙

### DTO → record

- **Response DTO**: 새로 만드는 DTO는 record 우선
- **Request DTO**: Jackson 역직렬화 확인 후 record 적용
- **적용 불가**: setter로 인-place 수정하는 DTO, 필드 10개 이상 + 빌더 필수
- **참고**: `docs/refactoring/dto-to-record.md`, `docs/refactoring/recordType/board/dto-record-refactoring.md`

### 검색 쿼리 (LIKE·인덱스)

- **`LIKE '%값%'`**: B-tree 인덱스 미사용 → 풀 스캔 유발. 가능하면 피할 것
- **해결 방향**: `LIKE '값%'` (접두사), FULLTEXT, 검색 엔진
- **예시**: Board 검색 → TITLE/CONTENT 개별 `LIKE %...%` 대신 FULLTEXT `MATCH(title, content) AGAINST`로 통합
- **참고**: `docs/refactoring/recordType/board/board-search-optimization.md`

## 위치 기반 서비스 (Location Service) 검색 규칙

### 주변 서비스 검색 요구사항

#### 1. 검색 우선순위 및 전략
- **키워드 검색이 최우선**: `keyword` 파라미터가 있으면 FULLTEXT 검색 수행 (FULLTEXT 인덱스 활용)
- **위치 기반 검색**: `latitude`, `longitude`, `radius`가 모두 있으면 반경 검색 (`ST_Distance_Sphere` 사용)
- **지역 계층 검색**: `sido`, `sigungu`, `eupmyeondong` 등 지역 파라미터가 있으면 지역 계층별 검색
- **우선순위**: `keyword` > `위치 기반` > `지역 계층`

#### 2. 초기 로드 전략
- **사용자 위치 있음**: 사용자 위치 기반 5km 반경 검색 (빠른 초기 컨텍스트 제공)
- **사용자 위치 없음**: 전체 조회 후 클라이언트 사이드 필터링
- **목적**: 사용자에게 빠르게 주변 정보 제공

#### 3. 위치 기반 검색 동작 방식
- **반경 검색**: `ST_Distance_Sphere` 함수 사용 (MySQL 공간 함수)
- **거리 계산**: 백엔드에서 반경 내 서비스만 반환, 프론트엔드에서 추가 거리 계산 및 정렬
- **거리순 정렬**: 가까운 순서대로 정렬 (거리 정보 포함)
- **반경 기본값**: 5km (5000m) - 초기 로드 시

#### 4. 키워드 검색과의 조합
- **키워드 + 위치**: 키워드 검색 후 위치 기반 필터링 (또는 위치 기반 검색 후 키워드 필터링)
- **키워드 + 카테고리**: 키워드 검색 후 카테고리 필터링
- **키워드 + 지역**: 키워드 검색 후 지역 필터링

#### 5. 지도 이동 시 동작
- **"지도는 상태를 바꾸지 않는다" 원칙**: 지도 이동 시 자동 API 호출 제거
- **"이 지역 검색" 버튼**: 사용자 확인 후 검색 실행
- **지역 선택 상태 초기화**: 위치 기반 검색 실행 시 지역 선택 상태 초기화

#### 6. 현재 문제점 및 개선 필요 사항
- **복잡한 검색 로직**: 여러 검색 방식이 섞여있어 예상치 못한 동작 발생 가능
- **검색 우선순위 불명확**: 키워드, 위치, 지역 검색이 동시에 있을 때 우선순위 처리 필요
- **초기 로드와 일반 검색 구분**: `isInitialLoad` 플래그로 구분하되, 로직이 복잡함
- **거리 계산 중복**: 백엔드와 프론트엔드에서 모두 거리 계산하는 경우 있음
- **검색 결과 일관성**: 지도 이동 시 "아까 본 장소"가 사라지는 문제

#### 7. 개선 방향
- **명확한 검색 전략 분리**: 키워드 검색, 위치 기반 검색, 지역 검색을 명확히 분리
- **단일 책임 원칙**: 각 검색 방식이 독립적으로 동작하도록 리팩토링
- **검색 결과 일관성**: 지역 계층 검색을 주 전략으로 사용하여 일관성 유지
- **성능 최적화**: 불필요한 거리 계산 제거, 인덱스 활용 최대화
- **사용자 경험 개선**: 검색 결과가 예상대로 나오도록 로직 단순화

#### 8. 참고 문서
- `docs/architecture/위치 기반 서비스 아키텍처.md`
- `docs/domains/location.md`
